<app-header-secretaria></app-header-secretaria>

<div class="min-h-screen py-12 px-6">
  <div class="w-full max-w-7xl mx-auto">
    <!-- Título y Subtítulo -->
    <div class="text-center mb-12">
      <h2 class="text-3xl font-semibold ">Gestión de Prácticas Profesionales</h2>
      <p class="mt-2 text-lg text-gray-600">Seleccione y asigne los profesores para la revisión de los informes de prácticas</p>
    </div>

    <!-- Contenedor de la grilla -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
      <!-- Tarjetas dinámicas -->
      <div *ngFor="let practica of practicasBackend; let i = index" class="bg-white shadow-xl rounded-lg border border-gray-300 w-full max-w-md">
        <!-- Cabecera de la tarjeta -->
        <div class="px-6 py-4">
          <h3 class="text-xl font-semibold text-blue-700 text-left">Práctica {{ practica.tipo_practica }}</h3>
          <p class="mt-2 text-sm text-gray-600 text-left">Información sobre la práctica realizada.</p>
        </div>

        <!-- Información principal -->
        <div class="border-t border-gray-300">
          <dl class="divide-y divide-gray-200">
            <!-- Nombre del alumno -->
            <div class="py-4 grid grid-cols-3 gap-4 px-6">
              <dt class="text-xs font-medium text-gray-500">Alumno</dt>
              <dd class="col-span-2 text-sm text-gray-900 font-semibold">{{ practica.alumno_nombre }}</dd>
            </div>

            <!-- Estado del informe -->
            <div class="py-4 grid grid-cols-3 gap-4 px-6">
              <dt class="text-xs font-medium text-gray-500">Estado Informe</dt>
              <dd class="col-span-2 text-sm font-semibold"
                  [ngClass]="{
                    'text-yellow-600': practica.estado_practica === 'REVISION_INFORME_ALUMNO',
                    'text-green-600': practica.estado_practica === 'REVISION_GENERAL',
                    'text-red-600': practica.estado_practica === 'ESPERA_INFORME_ALUMNO',
                    'text-blue-600': practica.estado_practica === 'CURSANDO'
                  }">
                {{ practica.estado_practica }}
              </dd>
            </div>

            <div class="py-4 grid grid-cols-3 gap-4 px-6">
              <dt class="text-xs font-medium text-gray-500">Fecha Inicio</dt>
              <dd class="col-span-2 text-sm text-gray-900 font-semibold">{{ practica.fecha_inicio| date: 'mediumDate' }}</dd>
            </div>

            <div class="py-4 grid grid-cols-3 gap-4 px-6">
              <dt class="text-xs font-medium text-gray-500">Fecha Finalización</dt>
              <dd class="col-span-2 text-sm text-gray-900 font-semibold">{{ practica.fecha_termino| date: 'mediumDate' }}</dd>
            </div>

            <div class="py-4 grid grid-cols-3 gap-4 px-6">
              <dt class="text-xs font-medium text-gray-500">Modalidad</dt>
              <dd class="col-span-2 text-sm text-gray-900 font-semibold">{{ practica.modalidad}}</dd>
            </div>

            <!-- Mostrar fila de Profesor solo si el informe NO está en "En espera de subida" -->
            <div *ngIf="practica.estado_practica === 'REVISION_INFORME_ALUMNO' || practica.estado_practica == 'REVISION_GENERAL'" class="py-4 grid grid-cols-3 gap-4 px-6">
              <dt class="text-xs font-medium text-gray-500">Profesor</dt>
              <dd class="col-span-2 text-sm font-semibold" [ngClass]="practica.academico_nombre ? 'text-gray-900' : 'text-red-600'">
                {{ practica.academico_nombre ? practica.academico_nombre: 'Asignar Profesor' }}
              </dd>
            </div>
          </dl>
        </div>

        <!-- Mostrar Dropdown solo si la práctica está en "En espera de revisión" -->
        <div *ngIf="practica.estado_practica === 'REVISION_INFORME_ALUMNO'" class="px-6 py-4 text-center">
          <!-- Botón Asignar Profesor o Modificar Profesor -->
          <button class="text-blue-600" (click)="abrirModal(practica)">
            {{ practica.academico_nombre ? 'Modificar Profesor' : 'Asignar Profesor' }}
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<p-dialog
  [(visible)]="modalDetalles"
  [modal]="true"
  [draggable]="false"
  [closable]="false"
  [dismissableMask]="true"
  [style]="{ width: '1000px' }"
>
  <ng-template pTemplate="header">
    <h2 class="text-2xl font-bold text-center text-blue-600">Detalles lol</h2>
  </ng-template>

  <ng-template pTemplate="content">
   
  </ng-template>

  <ng-template pTemplate="footer">
    <button
      type="button"
      class="bg-gray-400 hover:bg-gray-500 text-white px-3 py-2 rounded-lg"
      (click)="cancelarAsignacion()"
    >
      Cancelar
    </button>
    <button
      type="button"
      class="bg-blue-600 hover:bg-blue-700 ms-4 px-3 py-2 text-white rounded-lg"
      (click)="confirmarAsignacion()"
    >
      Confirmar
    </button>
  </ng-template>
</p-dialog>

<p-dialog
  [(visible)]="modalAsignacion"
  [modal]="true"
  [draggable]="false"
  [closable]="false"
  [dismissableMask]="true"
  [style]="{ width: '1000px' }"
>
  <ng-template pTemplate="header">
    <h2 class="text-2xl font-bold text-center text-blue-600">Seleccionar Profesor</h2>
  </ng-template>

  <ng-template pTemplate="content">
    <table class="w-full text-sm text-left text-gray-600 border-collapse">
      <thead class="text-xs text-gray-500 uppercase bg-blue-100 rounded-t-lg">
        <tr>
          <th class="px-6 py-3 rounded-tl-lg text-md border-b" style="width: 50%;">Profesor</th>
          <th class="px-6 py-3 text-md border-b" style="width: 25%;">Informes Asignados</th> 
          <th class="px-6 py-3 text-center rounded-tr-lg text-md border-b" style="width: 25%;">Acción</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let profesor of profesoresBackend" class="bg-white hover:bg-blue-50 transition-colors">
          <td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap border-b" style="word-wrap: break-word;">
            {{ profesor.nombre_academico }}
          </td>
          <td class="px-6 py-4 border-l border-b">{{ profesor.cantidad_informes }}</td>
          <td class="px-6 py-4 border-l border-b text-center">
            <button
              *ngIf="copiaPractica?.academico_nombre !== profesor.nombre_academico"
              (click)="asignarProfesor(profesor)"
              class="bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition px-4 py-2">
              Asignar
            </button>
            <button
              *ngIf="copiaPractica?.academico_nombre === profesor.nombre_academico"
              (click)="quitarProfesor()"
              class="bg-red-500 hover:bg-red-600 text-white rounded-lg transition px-4 py-2">
              Quitar
            </button>
          </td>
        </tr>
      </tbody>
    </table>    
  </ng-template>

  <ng-template pTemplate="footer">
    <button
      type="button"
      class="bg-gray-400 hover:bg-gray-500 text-white px-3 py-2 rounded-lg"
      (click)="cancelarAsignacion()"
    >
      Cancelar
    </button>
    <button
      type="button"
      class="bg-blue-600 hover:bg-blue-700 ms-4 px-3 py-2 text-white rounded-lg"
      (click)="confirmarAsignacion()"
    >
      Confirmar
    </button>
  </ng-template>
</p-dialog>

