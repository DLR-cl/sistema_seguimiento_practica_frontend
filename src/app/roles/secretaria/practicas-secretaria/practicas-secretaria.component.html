<app-header-secretaria></app-header-secretaria>

<div class="min-h-screen py-12 px-6">
  <div class="w-full max-w-7xl mx-auto">
    <!-- Título y Subtítulo -->
    <div class="text-center mb-12">
      <h2 class="text-3xl font-semibold text-blue-700">Gestión de Prácticas Profesionales</h2>
      <p class="mt-2 text-lg text-gray-600">Seleccione y asigne los profesores para la revisión de los informes de prácticas</p>
    </div>

    <!-- Contenedor de la grilla -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
      <!-- Tarjetas dinámicas -->
      <div *ngFor="let practica of practicas; let i = index" class="bg-white shadow-xl rounded-lg border border-gray-300 w-full max-w-md">
        <!-- Cabecera de la tarjeta -->
        <div class="px-6 py-4">
          <h3 class="text-xl font-semibold text-blue-700 text-left">Práctica {{ practica.tipo }}</h3>
          <p class="mt-2 text-sm text-gray-600 text-left">Información sobre la práctica realizada.</p>
        </div>

        <!-- Información principal -->
        <div class="border-t border-gray-300">
          <dl class="divide-y divide-gray-200">
            <!-- Nombre del alumno -->
            <div class="py-4 grid grid-cols-3 gap-4 px-6">
              <dt class="text-xs font-medium text-gray-500">Alumno</dt>
              <dd class="col-span-2 text-sm text-gray-900 font-semibold">{{ practica.nombreAlumno }}</dd>
            </div>

            <!-- Estado del informe -->
            <div class="py-4 grid grid-cols-3 gap-4 px-6">
              <dt class="text-xs font-medium text-gray-500">Estado Informe</dt>
              <dd class="col-span-2 text-sm font-semibold"
                  [ngClass]="{
                    'text-yellow-600': practica.estadoInforme === 'En espera de revisión',
                    'text-green-600': practica.estadoInforme === 'Revisado',
                    'text-red-600': practica.estadoInforme === 'En espera de subida'
                  }">
                {{ practica.estadoInforme }}
              </dd>
            </div>

            <!-- Fecha de finalización -->
            <div class="py-4 grid grid-cols-3 gap-4 px-6">
              <dt class="text-xs font-medium text-gray-500">Fecha Finalización</dt>
              <dd class="col-span-2 text-sm text-gray-900 font-semibold">{{ practica.fechaFinalizacion | date: 'mediumDate' }}</dd>
            </div>

            <!-- Mostrar fila de Profesor solo si el informe NO está en "En espera de subida" -->
            <div *ngIf="practica.estadoInforme !== 'En espera de subida'" class="py-4 grid grid-cols-3 gap-4 px-6">
              <dt class="text-xs font-medium text-gray-500">Profesor</dt>
              <dd class="col-span-2 text-sm font-semibold" [ngClass]="practica.profesor ? 'text-gray-900' : 'text-red-600'">
                {{ practica.profesor ? practica.profesor : 'Asignar Profesor' }}
              </dd>
            </div>
          </dl>
        </div>

        <!-- Mostrar Dropdown solo si la práctica está en "En espera de revisión" -->
        <div *ngIf="practica.estadoInforme === 'En espera de revisión'" class="px-6 py-4 text-center">
          <!-- Botón Asignar Profesor o Modificar Profesor -->
          <button class="text-blue-600" (click)="abrirModal(practica)">
            {{ practica.profesor ? 'Modificar Profesor' : 'Asignar Profesor' }}
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<p-dialog
  [(visible)]="modalAbierto"
  [modal]="true"
  [draggable]="false"
  [closable]="false"
  [dismissableMask]="true"
  [style]="{ width: '1000px' }"
>
  <ng-template pTemplate="header">
    <h2 class="text-2xl font-bold text-center text-blue-600">Seleccionar Profesor</h2>
  </ng-template>

  <ng-template pTemplate="content">
    <table class="w-full text-sm text-left text-gray-600 border-collapse">
      <thead class="text-xs text-gray-500 uppercase bg-blue-100 rounded-t-lg">
        <tr>
          <th class="px-6 py-3 rounded-tl-lg text-md border-b" style="width: 50%;">Profesor</th> <!-- Ancho mayor para "Profesor" -->
          <th class="px-6 py-3 text-md border-b" style="width: 25%;">Informes Asignados</th> <!-- Ancho menor para "Informes Asignados" -->
          <th class="px-6 py-3 text-center rounded-tr-lg text-md border-b" style="width: 25%;">Acción</th> <!-- Ancho igual para "Acción" -->
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let profesor of profesores" class="bg-white hover:bg-blue-50 transition-colors">
          <td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap border-b" style="word-wrap: break-word;">
            {{ profesor.nombre }}
          </td>
          <td class="px-6 py-4 border-l border-b">{{ profesor.informesAsignados }}</td>
          <td class="px-6 py-4 border-l border-b text-center">
            <button
              *ngIf="copiaPractica.profesor !== profesor.nombre"
              (click)="asignarProfesor(profesor)"
              class="bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition px-4 py-2">
              Asignar
            </button>
            <button
              *ngIf="copiaPractica.profesor === profesor.nombre"
              (click)="quitarProfesor()"
              class="bg-red-500 hover:bg-red-600 text-white rounded-lg transition px-4 py-2">
              Quitar
            </button>
          </td>
        </tr>
      </tbody>
    </table>    
  </ng-template>

  <ng-template pTemplate="footer">
    <button
      type="button"
      class="bg-gray-400 hover:bg-gray-500 text-white px-3 py-2 rounded-lg"
      (click)="cancelarAsignacion()"
    >
      Cancelar
    </button>
    <button
      type="button"
      class="bg-blue-600 hover:bg-blue-700 ms-4 px-3 py-2 text-white rounded-lg"
      (click)="confirmarAsignacion()"
    >
      Confirmar
    </button>
  </ng-template>
</p-dialog>
